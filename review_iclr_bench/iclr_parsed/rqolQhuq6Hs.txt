# LOGARITHMIC LANDSCAPE AND POWER-LAW ESCAPE
## RATE OF SGD

**Anonymous authors**
Paper under double-blind review

ABSTRACT

Stochastic gradient descent (SGD) undergoes complicated multiplicative noise for
the mean-square loss. We use this property of the SGD noise to derive a stochastic
differential equation (SDE) with simpler additive noise by performing a random
time change. In the SDE, the loss gradient is replaced by the logarithmized loss
gradient. By using this formalism, we obtain the escape rate formula from a local
minimum, which is determined not by the loss barrier height ∆L = L(θ[s]) −
_L(θ[∗]) between a minimum θ[∗]_ and a saddle θ[s] but by the logarithmized loss barrier
height ∆log L = log[L(θ[s])/L(θ[∗])]. Our escape-rate formula strongly depends
on the typical magnitude h[∗] and the number n of the outlier eigenvalues of the
Hessian. This result explains an empirical fact that SGD prefers flat minima with
low effective dimensions, which gives an insight into implicit biases of SGD.

1 INTRODUCTION

Deep learning has achieved breakthroughs in various applications in artificial intelligence such as
image classification (Krizhevsky et al., 2012; LeCun et al., 2015), speech recognition (Hinton et al.,
2012), natural language processing (Collobert & Weston, 2008), and natural sciences (Iten et al.,
2020; Bapst et al., 2020; Seif et al., 2021). Such unparalleled success of deep learning hinges
crucially on stochastic gradient descent (SGD) or its variants as an efficient training algorithm.

Although the loss landscape is highly nonconvex, the SGD often succeeds in finding a global
minimum. It has been argued that the SGD noise plays a key role in escaping from local minima (Jastrze¸bski et al., 2017; Wu et al., 2018; 2020; Zhu et al., 2019; Meng et al., 2020; Xie et al.,
2021; Liu et al., 2021). It has also been suggested that SGD has an implicit bias that is beneficial
for generalization. That is, SGD may help the network to find flat minima, which are considered to
imply good generalization (Keskar et al., 2017; Hoffer et al., 2017; Wu et al., 2018). How and why
does SGD help the network escape from bad local minima and find flat minima? These questions
have been addressed in several works, and it is now recognized that the SGD noise strength and
structure importantly affect the efficiency of escape from local minima. Our work follows this line
of research, and add new theoretical perspectives.

In physics and chemistry, escape from a local minimum of the (free) energy landscape due to thermal
noise at temperature T has been thoroughly discussed (Kramers, 1940; Langer, 1969). When the
(free) energy barrier is given by ∆E, the escape rate is proportional to e[−][∆][E/T], which is known
as the Arrhenius law. By analogy, in machine learning, escape from a local minimum of the loss
function is considered to be determined by the loss barrier height ∆L = L(θ[s]) _−_ _L(θ[∗]), where L(θ)_
denotes the loss function at the network parameters θ, θ[∗] stands for a local minimum of L(θ), and
_θ[s]_ denotes a saddle point that separates θ[∗] from other minima. If we assume that the SGD noise
is uniform and isotropic, which is often assumed in machine-learning literature (Jastrze¸bski et al.,
2017), the escape rate is proportional to e[−][∆][L/D], where D denotes the SGD noise strength.

In this paper, we show that inhomogeneity of the SGD noise strength brings about drastic modification for the mean-square loss. It turns out that the escape rate is determined by the logarithmized
loss barrier height ∆log L = log L(θ[s])−log L(θ[∗]) = log[L(θ[s])/L(θ[∗])]. In other words, the escape
rate is determined by not the difference but the ratio of L(θ[s]) and L(θ[∗]). This result means that even
if the loss barrier height ∆L is the same, minima with smaller values of L(θ[∗]) are more stable.


-----

Moreover, given the fact that the eigenvalue spectrum of the Hessian at a minimum consists of a bulk
of almost zero eigenvalues and outliers (Sagun et al., 2017; Papyan, 2019), our escape-rate formula
implies that SGD prefers flat minima with a low effective dimension, where the effective dimension
is defined as the number of outliers (MacKay, 1992) and flatness is measured by a typical magnitude
of outlier eigenvalues (Keskar et al., 2017). The previous theories (Jastrze¸bski et al., 2017; Wu et al.,
2018; Zhu et al., 2019; Meng et al., 2020; Xie et al., 2021; Liu et al., 2021) have also successfully
explained that SGD prefers flat minima, but not shown the preference of small effective dimensions.
The logarithmized loss naturally explains the latter, and sheds light on implicit biases of SGD.

**Main contributions: We obtain the following main results:**

-  We derive an equation for approximating the SGD noise in Eq. (6). Remarkably, the SGD
noise strength in the mean-square loss is shown to be proportional to the loss function,
which is experimentally verified in Sec. 5.2. A key ingredient in deriving Eq. (6) is the
_decoupling approximation given in Eq. (7). This is a novel approximate method introduced_
in our analysis, and hence we experimentally verify it in Sec. 5.1.

-  We derive a novel stochastic differential equation (SDE) in Eq. (14) via a random time
change introduced in Eq. (13). Although the original SDE (4) has a multiplicative noise,
the transformed SDE (14) has a simple additive noise with the gradient of the logarithmic
loss. This shows the convenience of the logarithmic loss landscape for understanding SGD.

-  We derive a novel form of SGD escape rate from a local minimum in Eq. (16). Remarkably,
the escape rate depends on the ratio between L(θ[∗]) and L(θ[s]). In Sec. 5.3, we experimentally test the validity of this result for linear regressions.

-  Our escape rate crucially depends on the flatness and the effective dimension, which shows
that SGD has implicit biases towards flat minima with low effective dimension. We also
show in Eq. (18) that a local minimum with an effective dimension n greater than a certain
critical value nc becomes unstable.

**Related works:** The role of the SGD noise structure has been discussed in some previous
works (Zhu et al., 2019; Xie et al., 2021; Liu et al., 2021; Meng et al., 2020; Wojtowytsch, 2021). It
was pointed out that the anisotropic nature of the SGD noise is important: the SGD noise covariance
matrix is aligned with the Hessian of the loss function, which is beneficial for escape from sharp
minima (Zhu et al., 2019; Xie et al., 2021; Liu et al., 2021). These previous works, however, do
not take the inhomogeneity of the SGD noise strength into account, and consequently, escape rates
derived there depend exponentially on the loss barrier height, which differs from our formula.

Compared with the anisotropy of the SGD noise, the inhomogeneity of the SGD noise strength has
been less explored. In (Meng et al., 2020; Wojtowytsch, 2021), the SGD dynamics under a statedependent noise is discussed. However, in these previous works, the connection between the noise
strength and the loss function was not theoretically established, and the logarithmized loss landscape
was not discussed. The instability due to large effective dimensions was also not shown. Another
recent work (Pesme et al., 2021) observed that the noise is proportional to the loss for specific simple
models. In our paper, such a result is derived for more generic models. G¨urb¨uzbalaban et al. (2021)
showed that SGD will converge to a heavy-tailed stationary distribution due to a multiplicative nature
of the SGD noise in a simple linear regression problem. Our paper strengthens this result: we argue
that such a heavy-tailed distribution generically appears for the mean-square loss.

2 BACKGROUND

2.1 SETUP

We consider supervised learning. Let D = {(x[(][µ][)], y[(][µ][)]) : µ = 1, 2, . . ., N _} be the training dataset,_
where x[(][µ][)] _∈_ R[d] denotes a data vector and y[(][µ][)] _∈_ R be its label. The network output for a given
input x is denoted by f (θ, x) ∈ R, where θ ∈ R[P] stands for a set of trainable parameters with P
being the number of trainable parameters (Extension to the multi-dimensional label and output is
straightforward). In this work, we focus on the mean-square loss


_f_ (θ, x[(][µ][)]) _y[(][µ][)][i][2]_ =: [1]
_−_ _N_


_ℓµ(θ)._ (1)
_µ=1_

X


_L(θ) =_


2N


_µ=1_


-----

The training proceeds through optimization of L(θ). In most machine-learning applications, the
optimization is done via SGD or its variants. In SGD, the parameter θk+1 at the time step k + 1 is
determined by

1
_θk+1 = θk_ _η_ _LBk_ (θk), _LBk_ (θ) = _ℓµ(θ),_ (2)
_−_ _∇_ 2B _µX∈Bk_

where η > 0 is the learning rate, Bk 1, 2, . . ., N with _Bk_ = B is a mini-batch used at the kth
time step, and LBk denotes the mini-batch loss. Since the training dataset ⊂{ _}_ _|_ _|_ _D is randomly divided_
into mini-batches, the dynamics defined by Eq. (2) is stochastic. When B = N, the full training
data samples are used for every iteration. In this case, the dynamics is deterministic and called
gradient descent (GD). SGD is interpreted as GD with stochastic noise. By introducing the SGD
noise ξk = −[∇LBk (θk) −∇L(θk)], Eq. (2) is rewritten as

_θk+1 = θk −_ _η∇L(θk) + ηξk._ (3)

Obviously, _ξk_ = 0, where the brackets denote the average over possible choices of mini-batches.
_⟨_ _⟩_
The noise covariance matrix is defined as Σ(θk) := _ξkξk[T]_
noise is important in analyzing the SGD dynamics, which will be discussed in Sec. 3.1. ⟨ _[⟩][. The covariance structure of the SGD]_

2.2 STOCHASTIC DIFFERENTIAL EQUATION FOR SGD

When the parameter update for each iteration is small, which is typically the case when the learning
rate η is small enough, we can consider the continuous-time approximation (Li et al., 2017; Smith
& Le, 2018). By introducing a continuous time variable t ∈ R and regarding η as an infinitesimal
time step dt, we have a SDE

_dθt = −∇L(θt)dt +_ _ηΣ(θt) · dWt,_ (4)

where dWt (0, IP dt) with In being the n-by-pn identity matrix, and the multiplicative noise
_∼N_

_ηΣ(θt) · dWt is interpreted as Itˆo since the noise ξk in Eq. (3) depends on θk but not on θk+1._
Throughout this work, we consider the continuous-time approximation (4) with Gaussian noise.

p

In machine learning, the gradient Langevin dynamics (GLD) is also considered, in which the
isotropic and uniform Gaussian noise is injected into the GD as

_dθt = −∇L(θt)dt +_ _√2DdWt,_ (5)

where D > 0 corresponds to the noise strength (it is also called the diffusion coefficient) (Sato
& Nakagawa, 2014; Zhang et al., 2017b; Zhu et al., 2019). The stationary probability distribution
_PGLD(θ) of θ for GLD is given by the Gibbs distribution PGLD(θ)_ _e[−][L][(][θ][)][/D]. We will see in_
_∝_
Sec. 4 that the SGD noise structure, which is characterized by Σ(θ), drastically alters the stationary
distribution and the escape rate from a local minimum.


_θk+1 = θk −_ _η∇LBk_ (θk), _LBk_ (θ) =


2B


3 THEORETICAL FORMULATION

3.1 STRUCTURE OF THE SGD NOISE COVARIANCE

The SGD noise covariance matrix Σ(θ) significantly affects the dynamics (Jastrze¸bski et al., 2017;
Smith & Le, 2018; Zhu et al., 2019; Ziyin et al., 2021). In this section, under some approximations, we derive the following expression of Σ(θ) for the mean-square loss within the the basin of
attractions (or the “valley”) of a local minimum θ[∗]:

Σ(θ) ≈ [2]NB [L][(][θ][)] _[H][(][θ][∗][)][,]_ (6)

where H(θ) = ∇[2]L(θ) is the Hessian. It should be noted that ∇L(θ[∗]) = 0 and H(θ[∗]) is
positive semidefinite at any local minima θ[∗]. We give a derivation below and the list of the
approximations and their justifications in Appendix A. In particular, the decoupling approxima_tion is a new tool and plays a key role in the derivation._ It states that the quantities ℓµ and
_Cf[(][µ][)](θ) :=_ _f_ (θ, x[(][µ][)]) _f_ (θ, x[(][µ][)])[T] are uncorrelated, which implies
_∇_ _∇_


= L(θ) [1]


_ℓµCf[(][µ][)](θ)_
_≈_
_µ=1_

X


_Cf[(][µ][)]_
_µ=1_

X


_Cf[(][µ][)](θ)._ (7)
_µ=1_

X


_ℓµ_
_µ=1_

X


-----

This approximation is promising for large networks in which ∇f looks a random vector. In Sec. 5.1,
we experimentally verify the decoupling approximation for the entire training dynamics.

Our formula (6) possesses two important properties. First, the noise is aligned with the Hessian,
which has been well known and pointed out in the literature (Jastrze¸bski et al., 2017; Zhu et al.,
2019; Xie et al., 2021; Liu et al., 2021). If the loss landscape has flat directions, which correspond
to the directions of the Hessian eigenvectors belonging to vanishingly small eigenvalues, the SGD
noise does not work along those directions. Consequently, SGD dynamics is frozen along those
flat directions, which effectively reduces the dimension of the parameter space explored by SGD
dynamics. This plays an important role in the escape efficiency. Indeed, we will see that the escape
rate crucially depends on the effective dimension of a given local minimum.

Second, the noise is proportional to the loss function, which is indeed experimentally confirmed
in Sec. 5.2. This property has not been pointed out and not been taken into account in previous
studies (Jastrze¸bski et al., 2017; Zhu et al., 2019; Xie et al., 2021; Liu et al., 2021) and therefore
gives new insights into the SGD dynamics. Indeed, this property allows us to formulate the Langevin
equation on the logarithmized loss landscape with simple additive noise as discussed in Sec. 3.2.
This new formalism yields the power-law escape rate, i.e. Eqs. (15) and (16), and the importance of
the effective dimension of local minima for their stability.

**Derivation of Eq. (6): We start from an analytic expression of Σ(θ), which reads**


Σ(θ) = [1]


_N −_ _B_

_N −_ 1


_≃_ _B[1]_


_ℓµ_ _ℓ[T]µ_
_µ=1_ _∇_ _∇_ _[−∇][L][∇][L][T]_

X


_ℓµ_ _ℓ[T]µ_
_µ=1_ _∇_ _∇_ _[−∇][L][∇][L][T]_

X


(8)


where B ≪ _N is assumed in the second equality. The derivation of Eq. (8) is found in Jastrze¸bski_
et al. (2017); Smith & Le (2018). Usually, the gradient noise variance dominates the square of the
gradient noise mean, and hence the term ∇L∇L[T] in Eq. (8) is negligible.

For the mean-square loss, we have ∇ℓµ = [f (θ, x[(][µ][)]) − _y[(][µ][)]]∇f_ (θ, x[(][µ][)]), and hence


_N_

_ℓµCf[(][µ][)](θ) ≈_ [2]NB[L][(][θ][)]
_µ=1_

X


_ℓµ_ _f_ (θ, x[(][µ][)]) _f_ (θ, x[(][µ][)])[T] =
_∇_ _∇_
_µ=1_

X


_Cf[(][µ][)](θ), (9)_
_µ=1_

X


Σ(θ) ≈


_BN_


_BN_


where the decoupling approximation (7) is used in the last equality. Equation (9) is directly related
to the Hessian of the loss function near a (local or global) minimum. The Hessian is written as

_N_ _N_

_H(θ) = ∇[2]L(θ) = N[1]_ _Cf[(][µ][)](θ) + N[1]_ _f_ (θ, x[(][µ][)]) − _y[(][µ][)][i]_ _∇[2]f_ (θ, x[(][µ][)]). (10)

_µ=1_ _µ=1_

X X h

It is shown by Papyan (2018) that the last term of Eq. (10) does not contribute to outliers (i.e. large
eigenvalues) of the Hessian. Dynamics near a local minimum is governed by outliers, and hence we
can ignore this term. At θ = θ[∗], we therefore obtain


_H(θ) =_ _L(θ) = [1]_
_∇[2]_ _N_


_N_

_Cf[(][µ][)](θ) + N[1]_
_µ=1_

X


_µ=1_


_H(θ[∗])_
_≈_ _N[1]_


_Cf[(][µ][)](θ[∗])._ (11)
_µ=1_

X


Let us assume Cf[(][µ][)](θ) _Cf[(][µ][)](θ[∗]) for θ within the valley of a local minimum θ[∗]. We then obtain_
_≈_
the desired expression (6) by substituting it into Eq. (9).

3.2 LOGARITHMIZED LOSS LANDSCAPE

Let us consider the Itˆo SDE (4) with the SGD noise covariance (6) near a local minimum θ[∗], which
is written as

2ηL(θt)

_dθt =_ _L(θt)dt +_ _H(θ[∗])_ _dWt._ (12)
_−∇_ _B_ _·_

r

Let us consider a stochastic time t(τ ) for τ ≥ 0 as

_t(τ_ )
_τ =_ _dt[′]_ _L(θt′_ ), (13)

0

Z


-----

and perform a random time change from t to τ (Øksendal, 1998). Correspondingly, we introduce
the Wiener process dW[˜] _τ ∼N_ (0, IP dτ ). Since dτ = L(θt)dt, we have dW[˜] _τ =_ _L(θt) · dWt. In_

terms of the notation _θ[˜]τ = θt, Eq. (12) is expressed as_

p


2ηH(θ[∗])


2ηH(θ[∗])


_dθ[˜]τ = −_


1

_L(θ[˜]τ_ )dτ +
_L(θ[˜]τ_ ) _∇_


_dW[˜]_ _τ = −_ _∇_ log L(θ[˜]τ ) _dτ +_
h i


_dW[˜]_ _τ_ _._ (14)


We should note that at a global minimum with L(θ) = 0, which is realized in an overparameterized
regime (Zhang et al., 2017a), the random time change through Eq. (13) is ill-defined since τ is
frozen at a finite value once the model reaches a global minimum. We can overcome this difficulty
by adding an infinitesimal constant ϵ > 0 to the loss, which makes the loss function positive without
changing the finite-time dynamics like the escape from a local minimum θ[∗] with L(θ[∗]) > 0.

In this way, the Langevin equation on the loss landscape L(θ) with multiplicative noise is transformed to that on the logarithmic loss landscape U (θ) = log L(θ) with simpler additive noise.
This formulation indicates the importance of considering the logarithmized loss landscape U (θ) =
log L(θ). In the following, we use Eq. (14) to discuss the escape efficiency from local minima.

4 ESCAPE RATE FROM LOCAL MINIMA

Let us consider a local minimum θ[∗] and its basin of attraction _θ∗_, which is the set of all the
_A_
starting points θ0 such that θt tends to θ[∗] as t →∞ if there is no noise. In order to escape from
the basin of θ[∗], θt must go through a saddle θ[s] with the help of noise. The escape time is defined
as τ = inf{t > 0 : θt /∈Aθ[∗] _, θ0 = θ[∗]}. The escape rate κ is then defined as the inverse of the_
mean escape time: κ = ⟨τ _⟩[−][1]. Our idea for evaluating the escape rate is applying the Kramers_
formula (Kramers, 1940) or its high-dimensional generalization (Langer, 1969; Bovier et al., 2004;
Berglund, 2013) to Eq. (14). It should be noted that the Kramers formula is applicable only for
additive noise, and hence it cannot be used for the original SDE (4) with multiplicative noise.

First, we present main results [Eqs. (15), (16), and (17)], and give their derivations later. For P = 1
(i.e. the single-variable case θ ∈ R), the escape rate through a saddle θ[s] is given by

_L(θs)_ _−(_ [1]2 [+] _ηhB[∗]_ [)]

_κ = [1]_ _h[∗]_ _h[s]_ _,_ (15)

2π _|_ _|_ _L(θ[∗])_

 

p

where h[∗] = H(θ[∗]). This is a variant of the Kramers formula (Kramers, 1940), which is accurate
when κ is small. We can derive Eq. (15) from Eq. (14) without any further approximations.

For θ ∈ R[P] with P > 1, the analysis is more involved and needs some assumptions and approximations, which are listed in Appendix A. We assume that the eigenvalue spectrum of the Hessian
_H(θ[∗]) at the local minimum θ[∗]_ consists of bulk of almost zero eigenvalues and outliers, which is
indeed empirically correct (Sagun et al., 2017; Papyan, 2019). We denote by h[∗] and n a typical
magnitude of outlier eigenvalues (i.e. the flatness) and the number of outlier eigenvalues (i.e. the effective dimension), respectively. As we discussed in Sec. 3.1, the SGD dynamics is frozen along flat
directions. Therefore SGD dynamics around the local minimum θ[∗] is restricted to the n-dimensional
_θmanifold spanned by the outlier eigenvectors by using n parameters z1, z2, . . ., zn ∈_ R as v θ1, v =2, . . ., v θ[∗] + _n ∈i=1R[z][P][i][v]of[i][. The Hessian restricted to this] H(θ[∗]). Now we parameterize_
outlier subspace is then written as _H[ˆ]_ (θ) := ∇z[2][L][(][θ][)][ ∈] [R][n][×][n][.]

[P][n]

We then obtain the following escape rate formula for P > 1:

_e[|]_ det H[ˆ] (θ[∗]) _L(θs)_ _−(_ _ηhB[∗]_ [+1][−] _[n]2_ [)]
_κ =_ _,_ (16)

_[|]2[h]π[s]_ s det H[ˆ] (θ[s]) _L(θ[∗])_

_|_ _|_  

where h[s]e [is the negative eigenvalue of][ H][(][θ][s][)][ corresponding to the escape direction.][1][ Again, Eq. (16)]
is valid when κ is small enough. It should be noted that Eq. (16) is reduced to Eq. (15) when n = 1.

1If eigenvalues of _Hˆ_ (θ[∗]) and those of _Hˆ_ (θ[s]) coincide with each other except for the escape direction e, det H[ˆ] (θ[∗])/ det H[ˆ] (θ[s]) = _h[∗]e[/h][s]e_ [holds,] and Eq. (16) is simplified as κ =

_B_

(1/2π) _h[∗]e[|][h][s]e[|][[][L][(][θ][s][)][/L][(][θ][∗][)]]−_ _ηh[∗]_ [+1][−] _[n]2_ .
p  


-----

For any P, the quasi-stationary distribution Pss(θ) within the valley of a local minimum θ[∗], which
can be identified as the stationary distribution restricted to the valley (Bianchi & Gaudilli`ere, 2016),
is written as
_Pss(θ)_ _L(θ)[−][φ],_ _φ = 1 +_ _[B]_ (17)
_∝_ _ηh[∗]_ _[.]_

Remarkably, it depends on L(θ) polynomially rather than exponentially as in the standard
GLD (Jastrze¸bski et al., 2017; Sato & Nakagawa, 2014; Zhang et al., 2017b). This polynomial
dependence on L(θ) is a key feature leading to the escape rate formula.

_B_
From Eq. (16) we can obtain some implications. The factor [L(θ[s])/L(θ[∗])][−][(] _ηh[∗]_ [+1][−] _[n]2_ [)] increases

with h[∗] and n, which indicates that sharp minima (i.e. minima with large h[∗]) or minima with large
_n are unstable. This fact explains why SGD finds flat minima with a low effective dimension n._
Equation (16) also implies that the effective dimension of any stable minima must satisfy

_B_
_n < nc := 2_ _._ (18)

_ηh[∗]_ [+ 1]

 

The instability due to a large effective dimension is a new insight naturally explained by the picture
of the logarithmized loss landscape. It arises from the ratio of the determinants of the logarithmizedloss Hessian: det ∇z[2][U] [(][θ][∗][)][/][|][ det][ ∇][2]z[U] [(][θ][s][)][|][ = [det ˆ]H(θ[∗])/| det H[ˆ] (θ[s])|] · [L(θ[s])/L(θ[∗])][n/][2].

**Derivation of Eq. (16) and Eq. (17): Now we give a derivation of Eqs. (16) and (17). Equation (15)**
is straightforwardly obtained by putting P = 1 in the derivation below (some approximations are
introduced below, but all of them are not necessary for P = 1).

As we already noted, SGD dynamics is restricted to the n-dimensional outlier subspace. First, we
assume that the anisotropy of the SGD noise within this n-dimensional space is not relevant, and
approximate the SGD noise in Eq. (14) as an isotropic one: 2ηH(θ[∗])/BdW[˜] _τ_ 2ηh[∗]/BdW[˜] _τ_,

_≈_

where h[∗] R[+] characterizes the magnitude of the Hessian outliers. This assumption is justified
_∈_ p p
when the loss landscape is isotropic within the n-dimensional subspace near the minimum. Even
if the Hessian at the minimum is not isotropic, this approximation is justified when the directions
of the Hessian eigenvectors do not change within the valley. In the latter case, the escape path is a
straight line along the direction of a Hessian eigenvector ve, where e 1, 2, . . ., n identifies the
_∈{_ _}_
escape direction, and h[∗] corresponds to the Hessian eigenvalue at the minimum along the escape
direction, i.e. h[∗] = h[∗]e[. See Appendix C for the details.]

Under this approximation, Eq. (14) becomes dzτ = −∇zUdτ + _√2TdW[˜]_ _τ_, where T = ηh[∗]/B. Its

quasi-stationary distribution _P[˜]ss(θ) within the valley including the local minimum θ = θ[∗]_ (i.e. z =
0) is then given by a Gibbs distribution with respect to U (θ): _P[˜]ss(θ)_ _e[−][U]_ [(][θ][)][/T] _L(θ)[−][B/][(][ηh][∗][)]._
_∝_ _∝_
This is the distribution function of _θ[˜]τ for a fixed τ_ . However, what we want is the quasi-stationary
distribution of θt for a fixed t. In Appendix B, by using Eq. (13), we show that the two distributions
are related with each other as Pss(θ) _L(θ)[−][1][ ˜]Pss(θ). We thus obtain Eq. (17)._
_∝_

The escape rate under the Langevin equation with isotropic additive noise is evaluated by using
celebrated Kramers formula (Kramers, 1940) or its high-dimensional generalization (Langer, 1969;
Bovier et al., 2004; Berglund, 2013). According to it, the escape rate κτ per unit τ is given by

_e[|]_ det _z[U]_ [(][θ][∗][)]
_κτ =_ _∇[2]_ (19)

_[|]2[u]π[s]_ s det _z[U]_ [(][θ][s][)][|] _[e][−][∆][U/T][,]_

_|_ _∇[2]_

where u[s]e [is the negative eigenvalue of][ ∇]z[2][U] [(][θ][s][)][ corresponding to the escape direction,][ ∆][U][ =]
_U_ (θ[s]) − _U_ (θ[∗]) is called the potential barrier, and ∆U/T is assumed to be large enough. What we
really want is the escape rate per unit time t. It is a reasonable assumption that θt stays close to
_θ[∗]_ for most times before escape, and hence τ is approximately given by τ ≃ _L(θ[∗])t. The escape_
rate κ per unit t is then given by κ = L(θ[∗])κτ . By combining it with Eq. (19), and substituting
_U_ (θ) = log L(θ), we finally obtain Eq. (16).

5 EXPERIMENTS

Our key theoretical observation is that the SGD noise strength is proportional to the loss function,
which is obtained as a result of the decoupling approximation. This property leads us to the Langevin


-----

(a) at initialization (b) at 50 epochs (c) at 500 epochs




10[2]

10[1]

10[0]


10[2]

10[1]

10[0]


10[2]

10[1]

10[0]



20 10 0 10

exact
decoupling

log(eigenvalues)


exact
decoupling


exact
decoupling


Figure 1: Comparison of the eigenvalue distributions of the left-hand side (exact expression) and the righthand side (decoupled one) of Eq. (12) in the main text. They agree with each other except for very small


10 2


10[2]

10[1]

10[0]


10

10

10


20 40 60 80

|Col1|exact decoupli|
|---|---|
||0 values) son of the e d one) of E he entire trai|
|loss (SGD n|oise strength)/(1.3 × 1|
|||


epoch


20 40 60 80 100

loss

(SGD noise strength)/(1.5 × 10[3])

epoch


10 3 10 2 10

|Col1|exact decoupling|Col3|
|---|---|---|
||10 eigenvalues) ssion) an xcept for|0 10 d the rig very sm|
||||


loss


Figure 2: Training dynamics of the loss and the SGD noise strength N . In the figure, we multiplied N by a
numerical factor to emphasize that N is actually proportional to the loss in a later stage of the training. (Left)
Fully-connected network trained by the Fashion-MNIST dataset. (Middle) Convolutional network trained by
the CIFAR-10 dataset. (Right) the loss vs N in the training of the convolutional network. The dashed line is a
straight line of slope 1, which implies N ∝ _L(θ)._

equation (14) with the logarithmized loss gradient and an additive noise through a random time
change (13). Equation (14) implies the stationary distribution (17) and the escape rate (16).

In Sec. 5.1, we show that the decoupling approximation is valid during entire training dynamics.
In Sec. 5.2, we measure the SGD noise strength and confirm that it is indeed proportional to the
loss function near a minimum. In Sec. 5.3, we experimentally test the validity of Eq. (17) for the
stationary distribution and Eq. (16) for the escape rate. We will see that numerical results for a linear
regression and for a non-linear neural network agree with our theoretical results.

5.1 EXPERIMENTAL VERIFICATION OF THE DECOUPLING APPROXIMATION


Let us compare the eigenvalue distribution of the exact matrix (1/N ) _µ=1_ _[ℓ][(][µ][)][C]f[(][µ][)]_ with that of

the decoupled one L(θ) · (1/N ) _µ=1_ _[C]f[(][µ][)]_ with Cf[(][µ][)] = ∇f (θ, x[(][µ][)])∇f (θ, x[(][µ][)])[T]. We consider a
binary classification problem using the first 10[4] samples of the MNIST dataset such that we classify[P][N]
each image into even (its label is y[P] = +1[N] ) or odd number (its label is y = 1). The network has two
_−_
hidden layers, each of which has 100 units and the ReLU activation, followed by the output layer of
a single unit with no activation. Starting from the Glorot initialization, the training is performed via
SGD with the mean-square loss, where we fix η = 0.01 and B = 100.

Figure 1 shows histograms of their eigenvalues at different stages of the training: (a) at initialization,
(b) after 50 epochs, and (c) after 500 epochs. We see that the exact matrix and the approximate
one have statistically similar eigenvalue distributions except for very small eigenvalues during the
training dynamics. This means that the decoupling approximation always holds during training.

5.2 MEASUREMENTS OF THE SGD NOISE STRENGTH


As a measure of the SGD noise strength, let us consider the norm of the noise vector ξ given by
_ξ[T]ξ_ = Tr Σ _/B, where_ := (1/N ) _µ=1_ _µ_ _[∇][ℓ][µ]_
_⟨mental results for two architectures and datasets. First, we consider training of the Fashion-MNIST⟩_ _≈N_ _N_ _[∇][ℓ][T]_ _[−∇][L][T][∇][L][. Here we present experi-]_
dataset by using a fully connected neural network with three hidden layers, each of which has 2 10[3]

[P][N]
_×_
units and the ReLU activation, followed by the output layer of 10 units with no activation (classifica

-----

(a) Exponent φ in Pss(θ) (b) tp for the linear regression (c) tp for the neural network


100000

10000

1000


1000

100


100



10

1

0.1

_d=1_
_d=5_

_d=10_

4 5 6 7


100

10

1

0.1


10


η=0.01

η=0.1

η=1


η=0.005

η=0.01

η=0.015


10 100 1000


10


Figure 3: (a) Exponent φ for the stationary distribution Pss(θ) ∝ _L(θ)[−][φ]_ for d = 1 in the linear regression.
Dashed lines show the theoretical prediction φ = 1 + B/(ηh[∗]). (b) Log-log plot of the mean first-passage
time tp vs c = L(θ[s])/L(θ[∗]) for B = 1 and η = 0.1 in the linear regression. Dashed lines show the theoretical
prediction, tp ∝ _κ[−][1]_ _∝_ _c[φ][−][d/][2]. (c) Log-log plot of tp vs c for B = 10 and various η in the neural network._
Dashed lines show the theoretical prediction, tp ∝ _κ[−][1]_ _∝_ _c[B/][(][ηh][∗][)+1][−][n/][2]_ with h[∗] = 95.6 and n = 9.

tion labels are given in the one-hot representation). Second, we consider training of the CIFAR-10
dataset by using a convolutional neural network. Following Keskar et al. (2017), let us denote a
stack of n convolutional layers of a filters and a kernel size of b × c with the stride length of d by
_n × [a, b, c, d]. We use the configuration: 3 × [64, 3, 3, 1], 3 × [128, 3, 3, 1], 3 × [256, 3, 3, 1], where_
a MaxPool(2) is applied after each stack. To all layers, the ReLU activation is applied. Finally, an
output layer consists of 10 units with no activation.

Starting from the Glorot initialization, the network is trained by SGD of the mini-batch size B = 100
and η = 0.1 for the mean-square loss. During the training, we measure the training loss and the noise
strength N for every epoch. Numerical results are given in Fig. 2. We see that roughly N ∝ _L at a_
later stage of the training, which agrees with our theoretical prediction.

Although N is not proportional to L at an early stage of training, it does not mean that Eq. (9) is
invalid there. Since the decoupling approximation is valid for the entire training dynamics, Eq. (9)
always holds. The reason why the SGD noise strength does not decrease with the loss function in the
early-stage dynamics is that 2L(θ) (1/N ) _µ=1_
_N ≈_ _×_ _[∇][f]_ [(][θ, x][(][µ][)][)][T][∇][f] [(][θ, x][(][µ][)][)][, but the quantity]

(1/N ) _µ=1_

_[∇][f]_ [(][θ, x][(][µ][)][)][T][∇][f] [(][θ, x][(][µ][)][)][ also changes during training.][P][N]

Although Eq. (9) is derived for the mean-square loss, the relation[P][N] _N ∝_ _L(θ) holds in more general_
loss functions; see Appendix D for general argument and experiments on the cross entropy loss.

5.3 EXPERIMENTAL TEST OF STATIONARY DISTRIBUTION AND ESCAPE RATE FORMULA


We experimentally verify our theoretical predictions. Below, we first present numerical results for a
simple linear regression problem, and then for a nonlinear model, i.e., a neural network.

Let us start from the following linear regression problem: each entry of x[(][µ][)] _∈_ R[d] and its label y[(][µ][)] _∈_ R are i.i.d. Gaussian random variables of zero mean and unit variance. We focus on the case of d ≪ _N_ . The output for an input x is given by f (θ, x) = θ[T]x, where
_θ ∈_ R[d] is the trainable network parameter. We optimize θ via SGD. The mean-square loss
_L(θ) = (1/2N_ ) _µ=1_ _θx[(][µ][)]_ _y[(][µ][)][][2]_ is quadratic and has a unique minimum at θ 0.
_−_ _≈_

First, we test Eq. (17), i.e. the stationary distribution, for  _d = 1 and N = 10[5]. We sampled the_

[P][N]

value of θk at every 100 iterations (k = j × 100, j = 1, 2, . . ., 10[4]) and made a histogram. We then
fit the histogram to the form Pss(θ) _L(θ)[−][φ]_ and determine the exponent φ. Our theory predicts
_∝_
_φ = 1 + B/(ηh[∗]). Numerical results for the exponent φ are presented in Fig. 3 (a) against B for_
three fixed learning rates η. In the same figure, theoretical values of φ are plotted in dashed lines.
The agreement between theory and experiment is fairly well. For a large learning rate η = 1, the
exponent slightly deviates from its theoretical value. This is due to the effect of a finite learning rate
(recall that η is assumed to be small in deriving the continuous-time stochastic differential equation).

Next, we test our formula on the escape rate, Eq. (16). Although the mean-square loss is quadratic
and no barrier crossing occurs, we can measure the first passage time, which imitates the escape
time for a non-convex loss landscape. Let us fix a threshold value of the loss function. The first


-----

passage time tp is defined as the shortest time at which the loss exceeds the threshold value. Here,
time t is identified as ηk, where k denotes the number of iterations in discrete SGD (2). We identify
the threshold value as L(θ[s]), i.e., the loss at the saddle in the escape problem. It is expected that tp
is similar to the escape time and proportional to κ[−][1].

The Hessian H = (1/N ) _µ=1_ _[x][(][µ][)][x][(][µ][)T][ has][ d][ nonzero eigenvalues, all of which are close to unity.]_
We can therefore identify h[∗] = 1 and n = d. The mean first passage time over 100 independent runs
is measured for varying threshold values which are specified by c = L(θ[s])/L(θ[∗]) > 1. Experimen
[P][N]
tal results for N = 10[4] are presented in Fig. 3 (b). Dashed straight lines have slope B/(ηh[∗]) + 1 −
_n/2. Experiments show that the first passage time behaves as tp_ [L(θ[s])/L(θ[∗])][B/][(][ηh][∗][)+1][−][n/][2],
_∝_
which agrees with our theoretical evaluation of κ[−][1] [see Eq. (16)]. We conclude that the escape rate
crucially depends on the effective dimension n, which is not explained by the previous results (Zhu
et al., 2019; Xie et al., 2021; Liu et al., 2021; Meng et al., 2020).

Our escape-rate formula (16) is also verified in a non-linear model. As in Sec. 5.1, we consider the
binary classification problem using the first 10[4] samples of MNINST dataset such that we classify
each image into even or odd. The network has one hidden layer with 10 units activated by ReLU,
followed by the output layer of a single unit with no activation. We always use the mean-square
loss. Starting from thee Glorot initialization, the network is pre-trained via SGD with η = 0.01
and B = 100 for 10[5] iterations. We find that after pre-training, the loss becomes almost stationary
around at L(θ) ≈ 0.035. We regard that the pre-trained network is near a local minimum. We then
further train the pre-trained network via SGD with a new choice of η and B (here we fix B = 10),
and measure the first passage time tp. The mean first-passage time over 100 independent runs is
measured for varying threshold values which are specified by c = L(θ[s])/L(θ[∗]) > 1. Experimental
results are presented in Fig. 3 (c). We see the power-law behavior, which is consistent with our
theory.

To further verify our theoretical formula (16), we also compare the power-law exponent for the mean
first-passage time with our theoretical prediction B/(ηh[∗]) + 1 − _n/2. Here, h[∗]_ and n are estimated
by the Hessian eigenvalues. In Appendix E, we present a numerical result for eigenvalues of the
approximate Hessian given by the right-hand side of Eq. (11). By identifying the largest eigenvalue
of the Hessian as h[∗], we have h[∗] _≈_ 95.6. On the other hand, it is difficult to precisely determine
the effective dimension n, but it seems reasonable to estimate n ∼ 10. It turns out that theory and
experiment agree with each other by choosing n = 9. Dashed lines in Fig. 3 (c) correspond to our
theoretical prediction κ[−][1] _∝_ _c[B/][(][ηh][∗][)+1][−][n/][2]_ with h[∗] = 95.6 and n = 9. This excellent agreement
shows that our theoretical formula (16) is also valid in non-linear models.

6 CONCLUSION

In this work, we have investigated SGD dynamics via a Langevin approach. With several approximations listed in Appendix A, we have derived Eq. (6), which shows that the SGD noise strength
is proportional to the loss function. This SGD noise covariance structure yields the stochastic differential equation (14) with additive noise near a minimum via a random time change (13). The
original multiplicative noise is reduced to simpler additive noise, but instead the gradient of the loss
function is replaced by that of the logarithmized loss function U (θ) = log L(θ). This stochastic
differential equation has a quasi-stationary distribution that decays polynomially with L(θ) near a
minimum (17), not exponentially as in the usual Gibbs distribution. This new formalism yields the
power-law escape rate formula (16) whose exponent depends on η, B, h[∗], and n.

Our escape-rate formula explains an empirical fact that SGD favors flat minima with low effective
dimensions. The effective dimension of a minimum must satisfy Eq. (18) for its stability. This result
as well as the formulation of SGD dynamics using the logarithmized loss landscape should help
understand more deeply the SGD dynamics and its implicit biases in machine learning problems.

Although the present work focuses on the Gaussian noise, the non-Gaussianity can also play an
important role. For example, S¸ims¸ekli et al. (2019) approximated SGD as a L´evy-driven SDE,
which explains why SGD finds wide minima. It would be an interesting future problem to take the
non-Gaussian effect into account.


-----

REFERENCES

Victor Bapst, Thomas Keck, A Grabska-Barwi´nska, Craig Donner, Ekin Dogus Cubuk, Samuel S
Schoenholz, Annette Obika, Alexander WR Nelson, Trevor Back, Demis Hassabis, and Pushmeet
Kohli. Unveiling the predictive power of static structure in glassy systems. Nature Physics, 16
(4):448–454, 2020.

Nils Berglund. Kramers’ Law: Validity, Derivations and Generalisations. Markov Processes and
_Related Fields, 19:459–490, 2013._

Alessandra Bianchi and Alexandre Gaudilli`ere. Metastable states, quasi-stationary distributions and
soft measures. Stochastic Processes and their Applications, 126:1622–1680, 2016.

Anton Bovier, Michael Eckhoff, V´eronique Gayrard, and Markus Klein. Metastability in reversible
diffusion processes I. Sharp asymptotics for capacities and exit times. Journal of the European
_Mathematical Society, 6:399–424, 2004._

Ronan Collobert and Jason Weston. A unified architecture for natural language processing: Deep
neural networks with multitask learning. In International Conference on Machine Learning, 2008.

Mert G¨urb¨uzbalaban, Umut S¸ims¸ekli, and Lingjiong Zhu. The Heavy-Tail Phenomenon in SGD. In
_International Conference on Machine Learning, 2021._

Geoffrey Hinton, Li Deng, Dong Yu, George E Dahl, Abdel-rahman Mohamed, Navdeep Jaitly,
Andrew Senior, Vincent Vanhoucke, Patrick Nguyen, Tara N Sainath, and Others. Deep neural
networks for acoustic modeling in speech recognition: The shared views of four research groups.
_IEEE Signal processing magazine, 29(6):82–97, 2012._

Elad Hoffer, Itay Hubara, and Daniel Soudry. Train longer, generalize better: closing the generalization gap in large batch training of neural networks. In Advances in Neural Information Processing
_Systems, 2017._

Raban Iten, Tony Metger, Henrik Wilming, L´ıdia Del Rio, and Renato Renner. Discovering Physical
Concepts with Neural Networks. Physical Review Letters, 124(1):10508, 2020.

Stanisław Jastrze¸bski, Zachary Kenton, Devansh Arpit, Nicolas Ballas, Asja Fischer, Yoshua Bengio, and Amos Storkey. Three Factors Influencing Minima in SGD. arXiv:1711.04623, 2017.

Nitish Shirish Keskar, Jorge Nocedal, Ping Tak Peter Tang, Dheevatsa Mudigere, and Mikhail
Smelyanskiy. On large-batch training for deep learning: Generalization gap and sharp minima.
In International Conference on Learning Representations, 2017.

Hendrik Anthony Kramers. Brownian motion in a field of force and the diffusion model of chemical
reactions. Physica, 7(4):284–304, 1940.

Alex Krizhevsky, Ilya Sutskever, and Geoffrey E Hinton. Imagenet classification with deep convolutional neural networks. In Advances in Neural Information Processing Systems, pp. 1097–1105,
2012.

James S. Langer. Statistical theory of the decay of metastable states. Annals of Physics, 54(2):
258–275, 1969.

Yann LeCun, Yoshua Bengio, and Geoffrey Hinton. Deep learning. Nature, 521(7553):436–444,
2015.

Qianxiao Li, Cheng Tai, and E. Weinan. Stochastic modified equations and adaptive stochastic
gradient algorithms. In International Conference on Machine Learning, 2017.

Kangqiao Liu, Liu Ziyin, and Masahito Ueda. Noise and Fluctuation of Finite Learning Rate
Stochastic Gradient Descent. In International Conference on Machine Learning, 2021.

Djc MacKay. Bayesian model comparison and backprop nets. In Advances in Neural Information
_Processing Systems, 1992._


-----

Qi Meng, Shiqi Gong, Wei Chen, Zhi Ming Ma, and Tie Yan Liu. Dynamic of Stochastic Gradient
Descent with State-Dependent Noise. arXiv:2006.13719, 2020.

Bernt Øksendal. Stochastic differential equations: an introduction with applications. Springer,
Berlin, 1998.

Vardan Papyan. The Full Spectrum of Deepnet Hessians at Scale: Dynamics with SGD Training
and Sample Size. arXiv:1811.07062, 2018.

Vardan Papyan. Measurements of three-level hierarchical structure in the outliers in the spectrum of
deepnet hessians. In International Conference on Machine Learning, 2019.

Scott Pesme, Loucas Pillaud-Vivien, and Nicolas Flammarion. Implicit Bias of SGD for Diagonal
Linear Networks: a Provable Benefit of Stochasticity. arXiv:2106.09524, 2021.

Levent Sagun, Utku Evci, V. Ugur G¨uney, Yann Dauphin, and L´eon Bottou. Empirical analysis of
the hessian of over-parametrized neural networks. arXiv:1706.04454, 2017.

Issei Sato and Hiroshi Nakagawa. Approximation analysis of stochastic gradient langevin dynamics by using fokker-planck equation and ito process. In International Conference on Machine
_Learning, 2014._

Alireza Seif, Mohammad Hafezi, and Christopher Jarzynski. Machine learning the thermodynamic
arrow of time. Nature Physics, 17:105–113, 2021.

Umut S¸ims¸ekli, Levent Sagun, and Mert Giirbiizbalaban. A tail-index analysis of stochastic gradient
noise in deep neural networks. In International Conference on Machine Learning, 2019.

Samuel L. Smith and Quoc V. Le. A Bayesian perspective on generalization and stochastic gradient
descent. In International Conference on Learning Representations, 2018.

Stephan Wojtowytsch. Stochastic gradient descent with noise of machine learning type. Part II:
Continuous time analysis. arXiv:2106.02588, 2021.

Jingfeng Wu, Wenqing Hu, Haoyi Xiong, Jun Huan, Vladimir Braverman, and Zhanxing Zhu. On
the Noisy Gradient Descent that Generalizes as SGD. In International Conference on Machine
_Learning, 2020._

Lei Wu, Chao Ma, and E. Weinan. How SGD selects the global minima in over-parameterized learning: A dynamical stability perspective. In Advances in Neural Information Processing Systems,
2018.

Zeke Xie, Issei Sato, and Masashi Sugiyama. A Diffusion Theory For Deep Learning Dynamics:
Stochastic Gradient Descent Exponentially Favors Flat Minima. In International Conference on
_Learning Representations, 2021._

Chiyuan Zhang, Samy Bengio, Moritz Hardt, Benjamin Recht, and Oriol Vinyals. Understanding
Deep Learning Requires Rethinking of Generalization. In International Conference on Learning
_Representations, 2017a._

Yuchen Zhang, Percy Liang, and Moses Charikar. A hitting time analysis of stochastic gradient
Langevin dynamics. In Proceedings of Machine Learning Research, 2017b.

Zhanxing Zhu, Jingfeng Wu, Bing Yu, Lei Wu, and Jinwen Ma. The anisotropic noise in stochastic gradient descent: Its behavior of escaping from sharp minima and regularization effects. In
_International Conference on Machine Learning, 2019._

Liu Ziyin, Kangqiao Liu, Takashi Mori, and Masahito Ueda. On Minibatch Noise: Discrete-Time
SGD, Overparametrization, and Bayes. arXiv:2102.05375, 2021.


-----

A LIST OF APPROXIMATIONS AND THEIR JUSTIFICATIONS

In Sec. 3.1, we made several approximations to derive the result (6). For clarity, we list the approximations made and their justifications below.

-  In Eq. (8), we make the approximation of B << N, which simplifies the expression but is
not essential. The main conclusion is not affected by this approximation.

-  We ignore ∇L∇L[T] in Eq. (8), which is justified near a local minimum.

-  In Eq. (9), we make the decoupling approximation (7), which is one of the key heuristic
approximations in our work. This approximation is verified experimentally in Sec. 5.1.

-  We ignore the last term of Eq. (10), which is a common approximation (Sagun et al., 2017).
This approximation is justified if we are only interested in the outliers of the Hessian eigenvalues. Indeed, outliers of the Hessian eigenvalues, which play dominant roles in escape
from local minima, are known to be attributable to the first term of the right-hand side of
Eq. (10) (Papyan, 2018).

-  In Eq. (11), we assume that the matrix (1/N ) _µ=1_
change so much in a valley with a given local minimum. This approximation is indirectly[∇][f] [(][θ, x][(][µ][)][)][∇][f] [(][θ, x][(][µ][)][)][T][ does not]
verified in Fig. 2 (the proportionality between the loss and the noise strength implies this

[P][N]
matrix is actually constant).

In deriving the escape rate for multi-variable cases in Sec. 4, we further make the following assumptions and approximations:

-  First of all, we discard a bulk of near-zero eigenvalues of the Hessian and restricted learning
dynamics within the subspace spanned by the outlier eigenvectors. This approximation
is justified because the SGD dynamics is almost frozen along flat directions of the loss
landscape.

-  We approximate the SGD noise as an isotropic one within the n-dimensional outlier subspace. This approximation is justified either when the loss landscape in the outlier subspace
is isotropic near the minimum or when the directions of the Hessian eigenvectors do not
change within the valley.

-  At the last part of the derivation, we approximate τ ≈ _L(θ[∗])t, which is justified because_
the model stays near a local minimum until it escapes from that minimum.

B STATIONARY DISTRIBUTION

Since _θ[˜]τ obeys a simple Langevin equation_


_dθ[˜]τ = −U_ _[′](θ[˜]τ_ ) +


2TdW[˜] _τ_ _,_ (20)


the stationary distribution of _θ[˜]τ is given by the Gibbs distribution_ _P[˜]ss(θ)_ _e[−][U]_ [(][θ][)][/T] . On the other
_∝_ _t_
hand, what we want is the stationary distribution Pss(θ) of θt, where θt = θ[˜]τ with τ = 0 _[dt][′][ L][(][θ][t][′]_ [)][.]
In this section, we show the relation between the two distributions: Pss(θ) _L(θ)[−][1][ ˜]Pss(θ)._
_∝_ R

We express the stationary distributions in terms of the long-time average of the delta function:

_s_ _s_

1 1
_Pss(θ) = lim_ _dt δ(θt_ _θ),_ _P˜ss(θ) = lim_ _dτ δ(θ[˜]τ_ _θ)._ (21)
_s→∞_ _s_ 0 _−_ _s→∞_ _s_ 0 _−_

Z Z

_t_
By using the relation τ = 0 _[dt][′][ L][(][θ][t][′]_ [)][, we have][ dτ][ =][ L][(][θ][t][)][dt][. For a sufficiently large][ t][, we also]
_s_
obtain τ ∼ _tL[¯], where_ _L[¯] := limR_ _s→∞(1/s)_ 0 _[dt][′][ L][(][θ][t][′]_ [)][ denotes the long-time average of][ L][(][θ][t][)][. By]
R


-----

using them, Pss(θ) is rewritten as

_Pss(θ)_ lim
_≈_ _s_
_→∞_


_sL¯_

0

Z


_L¯_ _θτ_ _θ)_

_dτ [δ][(˜]_ _−_

_L(θ[˜]τ_ )

_L¯_ _sL¯_

_dτ δ(θ[˜]τ_ _θ)_

_sL[¯]_ 0 _−_

Z


_L(θ) s[lim]_
_→∞_


_L_
= _P˜ss(θ)._ (22)

_L(θ)_

We thus obtain the desired relation, Pss(θ) _L(θ)[−][1][ ˜]Pss(θ)._
_∝_

C JUSTIFICATION OF THE ISOTROPIC-NOISE APPROXIMATION WITHIN THE
_n-DIMENSIONAL SUBSPACE_

We now show that the isotropic-noise approximation is valid when the directions of the eigenvectors of the Hessian do not change within the valley of a given local minimum. In this case,
_∂[2]U/∂zi∂zj = 0 for any i_ = j, where the Hessian at the minimum is given by H(θ[∗])
_n_ _̸_ _≈_
_i=1_ _[h]i[∗][v][i][v]i[T]_ [(][h][i][ is an eigenvalue and][ v][i][ is the corresponding eigenvector of][ H][(][θ][∗][)][) and the dis-]
placement vectorP _z ∈_ R[n] is defined by θ = θ[∗] + _i=1_ _[z][i][v][i][. The stochastic differential equation]_
_dz = −∇zUdτ +_ 2ηH(θ[∗])/BdW[˜] _τ is then equivalent to the following Fokker-Planck equation_

for the distribution function P (z, τ ) of z at τ : [P][n]

p

_n_

_∂P_ (z, τ ) = _∂_ _∂U_ _P_ + _[ηh]i[∗]_ _∂[2]_ _P_ _._ (23)

_∂τ_ _i=1_  _∂zi_  _∂zi_  _B_ _∂zi[2]_ 

X

Let us assume that the direction of eth eigenvector ve corresponds to the escape direction. We denote
by z R[n][−][1] the displacement perpendicular to the escape direction, and write z = (ze, z ). At
_⊥_ _∈_ _⊥_
the saddle z[s], ∇zU (z[s]) = 0, h[s]e _[<][ 0][ and][ h]i[s]_ _[>][ 0][ for all][ i][ ̸][=][ e][, where][ {][h]i[s][}][ is the set of eigenvectors]_
of the Hessian at z[s].

Under the above setting, we derive the escape rate formula following Kramers (1940). The steady
current J R[n] is aligned to the escape direction, and hence Je = 0 and J = 0. Let us denote by
_P_ _[∗]_ the total probability within the valley of a given minimum ∈ _θ[∗] ̸_ and by J the total current flowing⊥
to outside of the valley through the saddle θ[s] = θ[∗] + z[s]. It is assumed that J is small and P _[∗]_ is
almost stationary. The escape rate κτ is then given by


_κτ =_ (24)

_P[J]_

_[∗]_ _[.]_


The escape rate κ per unit time is given by


_κ = L(θ[∗])κτ = L(θ[∗])_ (25)

_P[J]_

_[∗]_ _[.]_

We now evaluate P _[∗]_ and J . To evaluate P _[∗], it is necessary to know about the stationary distribution_
near the minimum θ[∗]. Near the minimum θ[∗] (i.e. small z),


_U_ (θ) = log L(θ) _U_ (θ[∗]) + [(][θ][ −] _[θ][∗][)][T][H][(][θ][∗][)(][θ][ −]_ _[θ][∗][)]_ = U (θ[∗]) + _[z][T][H][(][θ][∗][)][z]_ (26)
_≈_ 2L(θ[∗]) 2L(θ[∗])


and
_∂U_
_∂zi_


_Hij[∗]_ _[z][j][,]_ (27)
_j=1_

X


_L(θ[∗])_


where H _[∗]_ = H(θ[∗]). By substituting it into the Fokker-Planck equation (23), we obtain


_∂P_ (z, τ )

_∂τ_


_zj_

_L(θ[∗]) [+][ η]B_


_Hij[∗]_
_j=1_

X


_._ (28)






_∂zi_


_∂zj_


_i=1_


-----

_U(θ) −_ _U(θ*) : z⊥_ = 0

⊥

_P(θ)_ _Jpath_

0 _ze[s]_ _ze[c]_

(θ = θ*) (θ = θ[s])


Figure 4: Schematic illustration of the escape from a potential barrier.


If for all j
_zj_

_L(θ[∗]) [+][ η]B_




_Pss(z) = 0,_ (29)


_∂zj_


_Pss(z) is a stationary distribution near the minimum θ[∗]. Indeed,_


_B_ _n_

2ηL(θ[∗] ) _i=1_ _[z]i[2]_

_Pss(z) = P_ (θ[∗])e[−] (30)

P

satisfies this condition. It should be noted that the stationary distribution is independent of the
Hessian eigenvalues _h[∗]i_
_{_ _[}][. By using Eq. (30),][ P][ ∗]_ [is evaluated as]

_n/2_

2ηL(θ∗)
_P_ _[∗]_ _≈_ _dz1dz2 . . . dznPss(z) = P_ (θ[∗]) _B_ _._ (31)
Z  

Next, let us evaluate J . The probability current J along the escape direction e is given by

_Je =_ _P_ _e_ _∂_ _P._ (32)
_−_ _∂z[∂U]e_ _−_ _[ηh]B[∗]_ _∂ze_

At the saddle, the current vector J perpendicular to the escape direction is zero, and hence the
_⊥_
probability distribution near the saddle with ze = ze[s] [and][ z][⊥] _[̸][= 0][ is also evaluated in a similar way]_
as in Eq. (30):
_B_
_P_ (ze = ze[s][, z][⊥][)][ ≈] _[P]_ [(][z][e] [=][ z]e[s][, z][⊥] [= 0)][e][−] 2ηL(θ[s] ) _[z]⊥[2]_ _._ (33)

By substituting it into Eq. (32), we obtain

_B_
_Je(ze[s][, z][⊥][) =][ J][path][e][−]_ 2ηL(θ[s] ) _[z]⊥[2]_ _,_ (34)

where the current along the escape path (z = 0) is denoted by Jpath := J(ze[s][, z][⊥] [= 0)][. The total]
_⊥_
current through the saddle is then evaluated as

2πηL(θs) (n−1)/2

_J =_ _dz⊥_ _Je(ze[s][, z][⊥][) =][ J][path]_ _B_ _._ (35)
Z  

hence the current along the escape path is approximately constantWhen the distribution function is almost stationary, Eq. (23) yields J ∂Je(ez(ez, ze, z⊥ _⊥= 0)= 0) ≈/∂zJpathe ≈. Since0, and_
_Je(ze, z⊥_ = 0) is given by Eq. (32) by putting z⊥ = 0, we have

_Jpath =_ _P_ _e_ _∂P_ = _e_ _−_ _ηhB[∗]e_ _[U][ ∂]_ _e_ _ηhB[∗]e_ _[U]_ _P_ _._ (36)
_−_ _∂z[∂U]e_ _z⊥=0_ _−_ _[ηh]B[∗]_ _∂ze_ _−_ _[ηh]B [∗]_ _[e]_ _∂ze_  

_B_

By multiplying e _ηh[∗]e_ _[U]_ in both sides and integrating over ze from 0 to ze[c][, where][ z]e[c] [defined as]

_U_ (θ[∗] + ze[c][v][e][) =][ U] [(][θ][∗][)][ (see Fig. 4), we obtain]

_Jpath_ _z0_ _e[c]_ _dze e_ _ηhB[∗]e_ _[U]_ = _[ηh]B e[∗]_ _[e]_ _ηhB[∗]e_ _[U]_ [(][θ][∗][)]P (θ[∗]), (37)

Z


_Pss(z) = P_ (θ[∗])e[−]


_J =_ _dz⊥_ _Je(ze[s][, z][⊥][) =][ J][path]_
Z


-----

where it is assumed that the probability at ze[c] [is small and negligible,][ P] [(][z][e] [=][ z]e[c][, z][⊥] [= 0)][ ≈] [0][. By]
using the saddle-point method, the integral in the left-hand side of Eq. (37) is evaluated as
_ze[c]_ _dze e_ _ηhB[∗]e_ _[U]_ _∞_ _dze exp_ _B_ _U_ (θ[s]) + _h[s]e_ _e[)][2]_

0 _≈_ _ηh[∗]e_ 2L(θ[s]) [(][z][e][ −] _[z][s]_

Z Z−∞   

1/2

= 2πηh[∗]e _e_ _ηhB[∗]e_ _[U]_ [(][θ][s][)]. (38)

_B_ _h[s]e[|][L][(][θ][s][)]_

 _|_ 

By substituting this result in Eq. (37), we obtain

1/2

_Jpath =_ _ηh∗e[|][h]e[s][|]_ _e−_ _ηhB[∗]e_ [∆][U] _P_ (θ[∗]), (39)

2πBL(θ[s])

 

where ∆U = U (θ[s]) − _U_ (θ[∗]). The total current J in Eq. (35) is then expressed as

= _h[∗]e[|][h][s]e[|]_ 2πηL(θs) _n/2_ _e−_ _ηhB[∗]e_ [∆][U] _P_ (θ[∗]). (40)
_J_ 2πL(θ[s]) _B_

p  

By using Eqs. (31) and (40), the escape rate κ in Eq. (25) is evaluated as


_L(θs)_

_L(θ[∗])_





_[n]_

2

_[−][1]_
_e[−]_




_h[∗]e[|][h][s]e[|]_

2π


_κ = L(θ[∗])_

_P[J]_

_[∗]_ [=]


_B_

_ηhe_ _∗_ [∆][U] _._ (41)

_,_ (42)


Since ∆U = log[L(θ[s])/L(θ[∗])], we finally obtain


_h[∗]e[|][h][s]e[|]_ _L(θs)_ _−_ _ηhB[∗]e_ [+1][−] _[n]2_

_κ =_   _,_ (42)

2π _L(θ[∗])_

p  

which is exactly identical to the escape rate formula derived in the main text using the isotropic-noise
approximation with h[∗] = h[∗]e[.]

In this way, the isotropic-noise approximation is justified even when the loss landscape is not
isotropic near the minimum. We have assumed that the directions of the eigenvectors of the Hessian
do not change within the valley of a given local minimum. Under this assumption, the Fokker-Planck
equation along the escape path is decoupled from the perpendicular directions z . Moreover, we
_⊥_
have seen that the stationary distribution near a minimum is independent of the Hessian eigenvalues.
These properties explain the reason why the isotropic-noise approximation is justified in this case.

D OTHER LOSS FUNCTIONS

In our paper, we mainly focus on the mean-square loss, for which we can analytically derive the
relation between the loss L(θ) and the SGD noise covariance Σ(θ). An important observation is that
the SGD noise strength N is proportional to the loss, i.e., N ∝ _L(θ) (see Sec. 5.2 of the main text_
for the definition of N ).

Here, we argue that the relation N ∝ _L(θ) also holds in more general situations. During the_
training, the value of ℓµ will fluctuate from sample to sample. At a certain time step of SGD, let
us suppose that N − _M samples in the training dataset are already classified correctly and hence_
_ℓµ_ 0, whereas the other M samples are not and hence ℓµ 1. The loss function is then given
_∼_ _∼_
by L(θ) = (1/N ) _µ=1_ _[ℓ][µ][ ∼]_ _[M/N]_ [. When][ ℓ][µ][ is small,][ ∇][ℓ][µ][ will also be small. Therefore,]
for N _M samples with ℓµ_ 0, _ℓµ_ 0 also holds. The other M samples will have non_−_ _∼_ _∇_ _∼_
small gradients: [P]ℓµ[N] _g, where g > 0 is a certain positive constant. We thus estimate_ as
_∥∇_ _∥[2]_ _∼_ _N_
(1/N ) _µ=1_ _µ_ _[∇][ℓ][µ]_
_N ≈the loss function._ _[∇][ℓ][T]_ _[∼]_ _[gM/N][ ∼]_ _[gL][(][θ][)][. In this way,][ N ∝]_ _[L][(][θ][)][ will hold, irrespective of]_

However, we emphasize that this is a crude argument. In particular, the above argument will not[P][N]
hold near a global minimum because all the samples are correctly classified there, which implies
that ℓµ is small for all µ, in contrast to the above argument relying on the existence of M wrongly
classified samples with ℓµ 1 and _ℓµ_ _g._
_∼_ _∥∇_ _∥[2]_ _∼_


-----

(a) (b)

10[0]


10

10

10

10

10


10

10

10

10


20 40 60 80 100

loss

(SGD noise strength)/(5 × 10[3])

epoch


20 40 60 80 100

loss

(SGD noise strength)/(6 × 10[4])

epoch


(c) (d)



10 4 10 2 10[0]

10[3]

10[1]

10 1

SGD noise strength10 3

4 2 [0]

loss


10 3 10 2 10

10[3]

10[2]

10[1]

10[0]

SGD noise strength10 1

3 2 1

loss


Figure 5: Training dynamics of the loss function and the SGD noise strength N for (a) a fully
connected network trained by the Fashion-MNIST dataset and (b) a convolutional network trained
by the CIFAR-10 dataset. In the figure, we multiplied N by a numerical factor to emphasize that
_N is actually proportional to the loss in an intermediate stage of the training. Loss vs N for (c) a_
fully connected network trained by the Fashion-MNIST and (d) a convolutional network trained by
CIFAR-10. Dashed lines in (c) and (d) are straight lines of slope 1, which imply N ∝ _L(θ)._

We now experimentally test the relation N ∝ _L(θ) for the cross-entropy loss. We consider the_
same architectures and datasets in Sec. 5.2 of the main text: a fully connected neural network
trained by Fashion-MNIST and a convolutional neural network trained by CIFAR-10 (see Sec. 5.2
for the detail). We fix B = 100 in both cases, and η = 0.1 for the fully connected network and
_η = 0.05 for the convolutional network. Experimental results are presented in Fig. 5. We find that_
the relation N ∝ _L(θ) seems to hold true at an intermediate stage of the training dynamics, although_
the proportionality is less clear compared with Fig. 2 in the main text for the mean-square loss.

We also find that for sufficiently small values of the loss, N ∝ _L(θ)[2]_ [see Fig. 5 (c) and (d)], whose
implications should merit further investigation in future studies.


E HESSIAN EIGENVALUES FOR A NEURAL NETWORK IN SEC. 5.3

We present numerical results on Hessian eigenvalues in a pre-trained neural network studied in
Sec. 5.3. Instead of the exact Hessian, we consider an approximate Hessian given on the right-hand
side of Eq. (11), i.e.,


_H(θ[∗])_
_≈_ _N[1]_


_∇f_ (θ, x[(][µ][)])∇f (θ, x[(][µ][)])[T]. (43)
_µ=1_

X


7861Eigenvalues). _{hi} are arranged in descending order as h1 ≥_ _h2 ≥· · · ≥_ _hP (in our model P =_

A histogram of the Hessian eigenvalues is presented in Fig. 6 (a). We see that most eigenvalues are
close to zero, which corresponds to the bulk, but there are some large eigenvalues, which correspond
to the outliers. The largest eigenvalue is λ1 = 95.6, which is identified as h[∗] in our theoretical
formula (16).


-----

(a) (b)

0 20 40 60 80 100 1 4 7 10 13 16 19 22 25 28

10[4]

10[3]

10[2]

10[1]

10[0]

0 20 40 60 80 100

eigenvalues

100

80

hi 60

40

20

0

1 4 7 10 13 16 19 22 25 28

i


Figure 6: Hessian eigenvalues for a pre-trained neural network studied in Sec. 5.3. (a) The histogram
of the Hessian eigenvalues. Most eigenvalues are close to zero, but there are some large eigenvalues,
which correspond to outliers.

Another important quantity is the effective dimension n corresnding to the number of outliers. Since
the outliers and the bulk are not sharply separated, it is difficult to precisely determine n. In Fig. 6
(b), we plot hi up to i = 30. From this figure, it seems reasonable to estimate n ∼ 10.

As a heuristic method of determining n, we can consider the following identification: first we define
the weight pi for ith eigenmode as pi = hi/ _j=1_ _[h][j][. We then determine][ n][ as]_

1

_P_ _−_

[P][P]

_n =_ _p[2]i_ _,_ (44)

_i=1_ !

X


which gives n = 12.7 in our case.

In Sec. 5.3, our formula (16) with n = 9 explains numerical results on the first-passage time.


-----

